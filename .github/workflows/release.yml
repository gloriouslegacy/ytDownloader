name: Build and Release

on:
  push:
    branches:
      - main          # main ë¸Œëœì¹˜ push â†’ Pre-release
    tags:
      - "v*"          # íƒœê·¸ push (ì˜ˆ: v1.0.0) â†’ ì •ì‹ Release

jobs:
  build:
    runs-on: windows-latest
    permissions:
      contents: write   # ë¦´ë¦¬ìŠ¤/íƒœê·¸ ì‘ì„± ê¶Œí•œ í•„ìš”

    steps:
      # 1. ì½”ë“œ ì²´í¬ì•„ì›ƒ
      - name: Checkout repository
        uses: actions/checkout@v3

      # 2. .NET SDK ì„¤ì •
      - name: Setup .NET
        uses: actions/setup-dotnet@v3
        with:
          dotnet-version: 8.0.x

      # 3. ytDownloader ë¹Œë“œ (WPF ì•±)
      - name: Build ytDownloader (WPF)
        run: dotnet publish ytDownloader/ytDownloader.csproj -c Release -r win-x64 --self-contained false -o publish/ytDownloader

      # 4. Updater ë¹Œë“œ (ë‹¨ë… exe)
      - name: Build Updater
        run: dotnet publish Updater/Updater.csproj -c Release -r win-x64 --self-contained false -o publish/Updater

      # 5. ì•„ì¹´ì´ë¸Œ ìƒì„±
      - name: Package ytDownloader
        run: Compress-Archive -Path publish/ytDownloader/* -DestinationPath yt_downloader_${{ github.ref_name }}.zip

      - name: Package Updater
        run: Compress-Archive -Path publish/Updater/Updater.exe -DestinationPath yt_updater_${{ github.ref_name }}.zip

      # 6. GitHub Release ìƒì„±
      - name: Create GitHub Release
        uses: softprops/action-gh-release@v2
        with:
          tag_name: ${{ github.ref_name }}
          name: Release ${{ github.ref_name }}
          body: |
            ğŸ“¦ ë¦´ë¦¬ìŠ¤ ì•ˆë‚´

            ë©”ì¸ í”„ë¡œê·¸ë¨: yt_downloader_${{ github.ref_name }}.zip  
            â†’ ì‹¤í–‰ íŒŒì¼ ë° í•„ìš”í•œ DLL í¬í•¨ (Updater.exe ì œì™¸)

            ì—…ë°ì´íŠ¸ ë„êµ¬: Updater.exe  
            â†’ ë³„ë„ Assetìœ¼ë¡œ ì œê³µë©ë‹ˆë‹¤. ZIPì—ëŠ” í¬í•¨ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

            âš ï¸ ì¤‘ìš”: ìë™ ì—…ë°ì´íŠ¸ ê¸°ëŠ¥ì€ ZIPë§Œ ë‹¤ìš´ë¡œë“œí•©ë‹ˆë‹¤.  
            Updater.exeëŠ” ì„¤ì¹˜ ì‹œ ê³ ì • ë°°ì¹˜ë˜ë©°, í•„ìš”ì‹œ Releaseì—ì„œ ìˆ˜ë™ìœ¼ë¡œ êµì²´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
          files: |
            yt_downloader_${{ github.ref_name }}.zip
            yt_updater_${{ github.ref_name }}.zip
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
